<!doctype html>
<html lang="en">
<!-- This page hosts the game part of sudoKUH -->
<head>
    <meta charset="utf-8">
    <title>play Sudoku</title>
    <meta name="description" content="A simple Sudoku PWA">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="app.webmanifest">

    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">

    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <!-- Add Sudoku script -->
    <script src="js/sudoku.js"></script>

    <style>
        table {
            margin: auto;
            width: 450px;
            height: 450px;
        }
        td {
            width: 50px;
            height: 50px;
            border: 1px solid #000;
            text-align: center;
            vertical-align: middle;
            line-height: 50px;
            font-size: 20px;
            cursor: pointer; /* Change the cursor when hovering over a cell */
        }
    </style>

</head>
<body>
<div id='replayButtonDiv'>
    <button id='replayButton' onclick="location.reload();">restart</button>
</div>
<h1 id="title">solve the Sudoku</h1>

<table id="sudoku"></table>
<script src="sudoku.js"></script>


<script>
    //generates the sudoku board and the solution
    var currentPuzzle = sudoku.generate('100');
    currentPuzzleSolution = sudoku.solve(currentPuzzle);
    console.log(currentPuzzle);
    console.log(currentPuzzleSolution);
    currentPuzzle = sudoku.board_string_to_grid(currentPuzzle)
    var table = document.getElementById('sudoku');
    for (var i = 0; i < 9; i++) {
        var row = document.createElement('tr');
        for (var j = 0; j < 9; j++) {
            var name = "SudokuField" + i + j;
            var button = document.createElement('button');
            button.id = name;
            button.textContent = currentPuzzle[i][j] === "." ?  " " : currentPuzzle[i][j];
            //Only add a button to change, if it was not set at the beginning
            if (button.textContent===" "){
                button.style.background = '#ADD8E6';
                button.onclick = function() {
                    //switch case to update the button content on click.
                    switch (this.textContent){
                        case ' ':
                            this.textContent="1";
                            break;
                        case '9':
                            this.textContent=" ";
                            break;
                        default:
                            this.textContent= parseInt(this.textContent) + 1;
                    }
                    let temp1 = this.id[11]
                    let temp2 = this.id[12]
                    //update the puzzle to . if the button is " " or the number
                    currentPuzzle[temp1][temp2]=this.textContent===' '? "." : this.textContent;
                    console.log(currentPuzzle);
                };
            }
            row.appendChild(button);
        }
        table.appendChild(row);
    }

</script>
<!-- This textarea displays a feedback message if the check Solution Button is pressed -->
<textarea id='checkMessage' style="with: 100%; height: 30%; display: none;"
onClick ="document.getElementById('checkMessage').style.display = 'none';"
>Winner</textarea>
<script>
    // Script that is run, when the check solution button is pressed.
    function checkSolution(){
        let checking = sudoku.board_grid_to_string(currentPuzzle);
        console.log('checking');
        document.getElementById('checkMessage').style.display = 'flex';
        if (checking===currentPuzzleSolution) {
            document.getElementById('checkMessage').textContent = 'Winner!';
        } else {
            document.getElementById('checkMessage').textContent = 'Try harder!';
        }

    }

</script>

<button onClick = "checkSolution()"> check solution</button>
</body>
</html>